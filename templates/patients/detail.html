{% extends 'base_design_system.html' %}
{% load static %}

{% block title %}{{ patient.user.name }} - NutriXpert Pro{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Command Header -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <h1 style="font-size: 32px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px;">{{ patient.user.name }}</h1>
                <div style="display: flex; align-items: center; gap: 16px; font-size: 14px; color: var(--text-muted); flex-wrap: wrap;">
                    <span><i class="fas fa-user"></i> {{ patient.get_age }} anos</span>
                    <span>‚Ä¢</span>
                    <span><i class="fas fa-target"></i> {{ patient.goal|default:"Emagrecimento e Ganho Muscular" }}</span>
                    <span>‚Ä¢</span>
                    <span><i class="fas fa-calendar"></i> In√≠cio: <span style="color: var(--accent); font-weight: 600;">{{ patient.start_date|date:"d/m/Y"|default:"15/01/2025" }}</span></span>
                    <span>‚Ä¢</span>
                    <span><i class="fas fa-chart-line"></i> <span style="color: var(--accent); font-weight: 600;">12 consultas</span></span>
                </div>
                
                <!-- View Toggle Buttons -->
                <div style="display: flex; gap: 8px; margin-top: 16px;">
                    <button class="btn btn-primary" onclick="switchView('dashboard')" id="btn-dashboard">
                        <i class="fas fa-chart-pie"></i> Dashboard Anal√≠tico
                    </button>
                    <button class="btn btn-secondary" onclick="switchView('timeline')" id="btn-timeline">
                        <i class="fas fa-history"></i> Timeline Evolutiva
                    </button>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 12px; align-items: center;">
                <button class="btn btn-secondary" onclick="toggleCompareMode()" id="btn-compare">
                    <i class="fas fa-balance-scale"></i> Modo Compara√ß√£o
                </button>
                <button class="btn btn-ai" onclick="showAIInsights()">
                    <i class="fas fa-brain"></i> IA Insights
                </button>
                <a href="{% url 'patients:edit' patient.id %}" class="btn btn-secondary">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <a href="{% url 'patients:list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Voltar
                </a>
            </div>
        </div>
    </div>

    <!-- Dashboard View -->
    <div id="dashboard-view" class="card" style="border-radius: 20px; padding: 32px; margin-top: 24px;">
        <h2 style="font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-bolt" style="color: var(--accent);"></i>
            Dashboard Anal√≠tico - Vis√£o Geral da Jornada
        </h2>

        <!-- Transformation Photos Section -->
        <div style="margin-bottom: 32px;">
            <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-camera" style="color: var(--accent);"></i> Transforma√ß√£o Visual
            </h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 32px;">
                <div style="aspect-ratio: 3/4; border-radius: 16px; display: flex; align-items: center; justify-content: center; text-align: center; position: relative; overflow: hidden; transition: all 0.3s ease; background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);" class="hover-lift">
                    <div style="color: white; font-weight: 600;">
                        <i class="fas fa-camera" style="font-size: 48px; margin-bottom: 12px; display: block;"></i>
                        <div style="font-size: 16px; margin-bottom: 4px;">FRONTAL</div>
                        <div style="font-size: 12px; opacity: 0.8;">Antes ‚Üí Depois</div>
                    </div>
                </div>
                <div style="aspect-ratio: 3/4; border-radius: 16px; display: flex; align-items: center; justify-content: center; text-align: center; position: relative; overflow: hidden; transition: all 0.3s ease; background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);" class="hover-lift">
                    <div style="color: white; font-weight: 600;">
                        <i class="fas fa-camera" style="font-size: 48px; margin-bottom: 12px; display: block;"></i>
                        <div style="font-size: 16px; margin-bottom: 4px;">LATERAL</div>
                        <div style="font-size: 12px; opacity: 0.8;">Antes ‚Üí Depois</div>
                    </div>
                </div>
                <div style="aspect-ratio: 3/4; border-radius: 16px; display: flex; align-items: center; justify-content: center; text-align: center; position: relative; overflow: hidden; transition: all 0.3s ease; background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);" class="hover-lift">
                    <div style="color: white; font-weight: 600;">
                        <i class="fas fa-camera" style="font-size: 48px; margin-bottom: 12px; display: block;"></i>
                        <div style="font-size: 16px; margin-bottom: 4px;">COSTAS</div>
                        <div style="font-size: 12px; opacity: 0.8;">Antes ‚Üí Depois</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Metrics Cards -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 32px;">
            <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 16px; padding: 24px; transition: all 0.3s ease; position: relative; overflow: hidden; border-left: 4px solid var(--ai-accent);" 
                 onmouseover="this.style.borderColor='var(--accent)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(59, 130, 246, 0.3)';" 
                 onmouseout="this.style.borderColor='var(--border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderLeft='4px solid var(--ai-accent)';">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text-secondary);">
                        <i class="fas fa-weight"></i> Peso
                    </div>
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                </div>
                <div style="display: flex; align-items: end; justify-content: space-between; margin-bottom: 16px;">
                    <div style="font-size: 32px; font-weight: 700; color: var(--text-primary); transition: all 0.3s ease;">78<span style="font-size: 16px; color: var(--text-muted);">kg</span></div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--success);">-7</div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; color: var(--text-secondary);">85</div>
                        <div style="font-size: 12px; color: var(--text-muted);">inicial</div>
                    </div>
                </div>
                <div style="width: 100%; height: 8px; background: var(--bg-hover); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                    <div style="height: 100%; border-radius: 4px; transition: all 0.3s ease; background: var(--success); width: 70%;"></div>
                </div>
                <div style="font-size: 12px; color: var(--text-muted); text-align: center;">Meta: 72kg</div>
            </div>

            <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 16px; padding: 24px; transition: all 0.3s ease; position: relative; overflow: hidden; border-left: 4px solid var(--ai-accent);" 
                 onmouseover="this.style.borderColor='var(--accent)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(59, 130, 246, 0.3)';" 
                 onmouseout="this.style.borderColor='var(--border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderLeft='4px solid var(--ai-accent)';">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text-secondary);">
                        <i class="fas fa-percentage"></i> Gordura
                    </div>
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                </div>
                <div style="display: flex; align-items: end; justify-content: space-between; margin-bottom: 16px;">
                    <div style="font-size: 32px; font-weight: 700; color: var(--text-primary); transition: all 0.3s ease;">22.8<span style="font-size: 16px; color: var(--text-muted);">%</span></div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--success);">-5.2</div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; color: var(--text-secondary);">28</div>
                        <div style="font-size: 12px; color: var(--text-muted);">inicial</div>
                    </div>
                </div>
                <div style="width: 100%; height: 8px; background: var(--bg-hover); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                    <div style="height: 100%; border-radius: 4px; transition: all 0.3s ease; background: var(--success); width: 65%;"></div>
                </div>
            </div>

            <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 16px; padding: 24px; transition: all 0.3s ease; position: relative; overflow: hidden; border-left: 4px solid var(--ai-accent);" 
                 onmouseover="this.style.borderColor='var(--accent)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(59, 130, 246, 0.3)';" 
                 onmouseout="this.style.borderColor='var(--border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderLeft='4px solid var(--ai-accent)';">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text-secondary);">
                        <i class="fas fa-dumbbell"></i> M√∫sculo
                    </div>
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                </div>
                <div style="display: flex; align-items: end; justify-content: space-between; margin-bottom: 16px;">
                    <div style="font-size: 32px; font-weight: 700; color: var(--text-primary); transition: all 0.3s ease;">59.5<span style="font-size: 16px; color: var(--text-muted);">kg</span></div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--success);">+1.5</div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; color: var(--text-secondary);">58</div>
                        <div style="font-size: 12px; color: var(--text-muted);">inicial</div>
                    </div>
                </div>
                <div style="width: 100%; height: 8px; background: var(--bg-hover); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                    <div style="height: 100%; border-radius: 4px; transition: all 0.3s ease; background: var(--success); width: 75%;"></div>
                </div>
            </div>

            <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 16px; padding: 24px; transition: all 0.3s ease; position: relative; overflow: hidden; border-left: 4px solid var(--ai-accent);" 
                 onmouseover="this.style.borderColor='var(--accent)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(59, 130, 246, 0.3)';" 
                 onmouseout="this.style.borderColor='var(--border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderLeft='4px solid var(--ai-accent)';">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text-secondary);">
                        <i class="fas fa-calculator"></i> IMC
                    </div>
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                </div>
                <div style="display: flex; align-items: end; justify-content: space-between; margin-bottom: 16px;">
                    <div style="font-size: 32px; font-weight: 700; color: var(--text-primary); transition: all 0.3s ease;">26.4</div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--success);">-2.4</div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; color: var(--text-secondary);">28.8</div>
                        <div style="font-size: 12px; color: var(--text-muted);">inicial</div>
                    </div>
                </div>
                <div style="width: 100%; height: 8px; background: var(--bg-hover); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                    <div style="height: 100%; border-radius: 4px; transition: all 0.3s ease; background: var(--success); width: 60%;"></div>
                </div>
            </div>

            <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 16px; padding: 24px; transition: all 0.3s ease; position: relative; overflow: hidden; border-left: 4px solid var(--ai-accent);" 
                 onmouseover="this.style.borderColor='var(--accent)'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px rgba(59, 130, 246, 0.3)';" 
                 onmouseout="this.style.borderColor='var(--border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderLeft='4px solid var(--ai-accent)';">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--text-secondary);">
                        <i class="fas fa-ruler"></i> Abd√¥men
                    </div>
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                </div>
                <div style="display: flex; align-items: end; justify-content: space-between; margin-bottom: 16px;">
                    <div style="font-size: 32px; font-weight: 700; color: var(--text-primary); transition: all 0.3s ease;">85<span style="font-size: 16px; color: var(--text-muted);">cm</span></div>
                    <div style="font-size: 24px; font-weight: 700; color: var(--success);">-10</div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; color: var(--text-secondary);">95</div>
                        <div style="font-size: 12px; color: var(--text-muted);">inicial</div>
                    </div>
                </div>
                <div style="width: 100%; height: 8px; background: var(--bg-hover); border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                    <div style="height: 100%; border-radius: 4px; transition: all 0.3s ease; background: var(--success); width: 80%;"></div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;">
            <!-- Evolution Chart -->
            <div style="background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 16px; padding: 20px; transition: all 0.3s ease;" class="hover-lift">
                <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-chart-line" style="color: var(--accent);"></i> Evolu√ß√£o de Composi√ß√£o Corporal
                </h3>
                <canvas id="evolutionChart" style="width: 100%; height: 200px;"></canvas>
            </div>

            <!-- Radar Chart -->
            <div style="background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 16px; padding: 20px; transition: all 0.3s ease;" class="hover-lift">
                <h3 style="font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-crosshairs" style="color: var(--accent);"></i> Radar Corporal - Evolu√ß√£o de Medidas
                </h3>
                <canvas id="radarChart" style="width: 100%; height: 200px;"></canvas>
            </div>

        <!-- Lab Exams Section -->
        <div style="margin-bottom: 32px;">
            <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-flask" style="color: var(--accent);"></i> Hist√≥rico de Exames Laboratoriais
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 32px;">
                <div style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); border-radius: 16px; padding: 20px; transition: all 0.3s ease;" class="hover-lift">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <i class="fas fa-file-medical-alt" style="color: var(--danger);"></i>
                        <span style="font-weight: 600; color: var(--danger);">Hemograma Completo</span>
                    </div>
                    <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
                        <i class="fas fa-calendar"></i> 09/11/2025
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                        <div style="margin-bottom: 4px;"><strong>Hemoglobina:</strong> 13.5 g/dL (normal)</div>
                        <div style="margin-bottom: 4px;"><strong>Colesterol:</strong> 180 mg/dL (normal)</div>
                        <div style="margin-bottom: 4px;"><strong>Glicose:</strong> 85 mg/dL (normal)</div>
                    </div>
                    <div style="font-size: 12px; color: var(--accent); font-style: italic;">
                        Todos os valores dentro da normalidade. Boa resposta ao protocolo nutricional.
                    </div>
                </div>

                <div style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); border-radius: 16px; padding: 20px; transition: all 0.3s ease;" class="hover-lift">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <i class="fas fa-file-medical-alt" style="color: var(--danger);"></i>
                        <span style="font-weight: 600; color: var(--danger);">Lipidograma + Glicemia</span>
                    </div>
                    <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
                        <i class="fas fa-calendar"></i> 09/10/2025
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                        <div style="margin-bottom: 4px;"><strong>Hemoglobina:</strong> 13.2 g/dL (normal)</div>
                        <div style="margin-bottom: 4px;"><strong>Colesterol:</strong> 195 mg/dL (leve eleva√ß√£o)</div>
                        <div style="margin-bottom: 4px;"><strong>Glicose:</strong> 92 mg/dL (normal)</div>
                    </div>
                    <div style="font-size: 12px; color: var(--accent); font-style: italic;">
                        Ajuste na dieta para otimizar perfil lip√≠dico.
                    </div>
                </div>

                <div style="background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.2); border-radius: 16px; padding: 20px; transition: all 0.3s ease;" class="hover-lift">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <i class="fas fa-file-medical-alt" style="color: var(--danger);"></i>
                        <span style="font-weight: 600; color: var(--danger);">Exames Iniciais</span>
                    </div>
                    <div style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
                        <i class="fas fa-calendar"></i> 15/01/2025
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
                        <div style="margin-bottom: 4px;"><strong>Hemoglobina:</strong> 12.8 g/dL (leve anemia)</div>
                        <div style="margin-bottom: 4px;"><strong>Colesterol:</strong> 220 mg/dL (elevado)</div>
                        <div style="margin-bottom: 4px;"><strong>Glicose:</strong> 105 mg/dL (pr√©-diabetes)</div>
                    </div>
                    <div style="font-size: 12px; color: var(--accent); font-style: italic;">
                        Baseline para monitoramento. Recomendado suplementa√ß√£o de ferro.
                    </div>
                </div>
            </div>
        </div>

        <!-- Diet History Section -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;">
            <div style="background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.2); border-radius: 16px; padding: 24px; transition: all 0.3s ease;" class="hover-lift">
                <h4 style="font-weight: 600; color: var(--success); margin-bottom: 16px;">Evolu√ß√£o de Planos Nutricionais</h4>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-left: 4px solid var(--success); border-radius: 8px; padding: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div>
                                <div style="font-weight: 600; font-size: 14px; color: var(--text-primary);">Plano Inicial de Emagrecimento (Low-Carb)</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">In√≠cio: 15/01/2025 ‚Ä¢ Low-Carb com Ciclagem</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Dura√ß√£o: 3 meses</div>
                            </div>
                            <div style="text-align: right; font-size: 12px; color: var(--text-secondary);">
                                <div style="margin-bottom: 2px;">Cal: 1800kcal</div>
                                <div style="margin-bottom: 2px;">Prot: 150g</div>
                                <div style="margin-bottom: 2px;">Carbs: 100g</div>
                                <div style="margin-bottom: 2px;">Gord: 80g</div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--accent);">Primeira dieta low-carb: In√≠cio com 100g carbs/dia para adapta√ß√£o.</div>
                    </div>

                    <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-left: 4px solid var(--success); border-radius: 8px; padding: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div>
                                <div style="font-weight: 600; font-size: 14px; color: var(--text-primary);">Plano de Recarga Carboidratos</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">In√≠cio: 15/04/2025 ‚Ä¢ Carb Cycling (Alta/Baixa)</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Dura√ß√£o: 2 meses</div>
                            </div>
                            <div style="text-align: right; font-size: 12px; color: var(--text-secondary);">
                                <div style="margin-bottom: 2px;">Cal: 2000kcal</div>
                                <div style="margin-bottom: 2px;">Prot: 160g</div>
                                <div style="margin-bottom: 2px;">Carbs: 200g</div>
                                <div style="margin-bottom: 2px;">Gord: 70g</div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--accent);">Primeira recarga de carboidratos: Aumento para 200g nos dias de treino.</div>
                    </div>

                    <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-left: 4px solid var(--success); border-radius: 8px; padding: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div>
                                <div style="font-weight: 600; font-size: 14px; color: var(--text-primary);">Plano de Defini√ß√£o v1.0</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">In√≠cio: 15/06/2025 ‚Ä¢ Keto Adaptado com Refeeds</div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Dura√ß√£o: Ongoing</div>
                            </div>
                            <div style="text-align: right; font-size: 12px; color: var(--text-secondary);">
                                <div style="margin-bottom: 2px;">Cal: 1700kcal</div>
                                <div style="margin-bottom: 2px;">Prot: 170g</div>
                                <div style="margin-bottom: 2px;">Carbs: 50g</div>
                                <div style="margin-bottom: 2px;">Gord: 90g</div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--accent);">Atual: Foco em defini√ß√£o muscular com refeeds semanais.</div>
                    </div>
                </div>
            </div>

            <div style="background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.2); border-radius: 16px; padding: 24px; transition: all 0.3s ease;" class="hover-lift">
                <h4 style="font-weight: 600; color: var(--success); margin-bottom: 16px;">Evolu√ß√£o de Macros ao Longo do Tempo</h4>
                <canvas id="macrosChart" style="width: 100%; height: 250px;"></canvas>
            </div>
        </div>
        </div>

    <!-- Timeline View -->
    <div id="timeline-view" style="display: none;">
        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 32px;">
            <h2 style="font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-history" style="color: var(--accent);"></i>
                Timeline Evolutiva da Jornada
            </h2>
            <div style="position: relative;">
                <div style="position: absolute; left: 32px; top: 0; bottom: 0; width: 2px; background: var(--accent);"></div>
                
                <div style="position: relative; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 24px; margin-left: 64px; transition: all 0.3s ease;" class="hover-lift" data-consultation-id="1">
                    <div style="position: absolute; left: -48px; top: 24px; width: 32px; height: 32px; background: var(--gradient-ai); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 14px;">#1</div>
                    <div onclick="toggleConsultationDetails(1)" style="cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <i class="fas fa-calendar" style="color: var(--accent);"></i>
                                    <span style="font-weight: 600; color: var(--text-primary);">15/01/2025</span>
                                    <span style="background: var(--gradient-ai); color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">üé¨ IN√çCIO DA JORNADA</span>
                                </div>
                                <div style="font-size: 14px; color: var(--text-muted);">298 dias atr√°s ‚Ä¢ Consulta #1</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 700; color: var(--text-primary);">85kg</div>
                                <div style="font-size: 14px; color: var(--text-muted);">28% gordura</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Nutrition Command Center JavaScript
let compareMode = false;
let selectedConsultations = [];

document.addEventListener('DOMContentLoaded', function() {
    // Initialize charts
    initializeCharts();
    
    // Apply saved theme (subordinate to dashboard)
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
    }
});

// View Switching Functions - Integrado com Design System
function switchView(viewName) {
    const dashboardView = document.getElementById('dashboard-view');
    const timelineView = document.getElementById('timeline-view');
    const btnDashboard = document.getElementById('btn-dashboard');
    const btnTimeline = document.getElementById('btn-timeline');
    
    if (viewName === 'dashboard') {
        dashboardView.style.display = 'block';
        timelineView.style.display = 'none';
        btnDashboard.className = 'btn btn-primary';
        btnTimeline.className = 'btn btn-secondary';
    } else if (viewName === 'timeline') {
        dashboardView.style.display = 'none';
        timelineView.style.display = 'block';
        btnDashboard.className = 'btn btn-secondary';
        btnTimeline.className = 'btn btn-primary';
    }
}

// Compare Mode Functions - Integrado com Design System
function toggleCompareMode() {
    compareMode = !compareMode;
    const btnCompare = document.getElementById('btn-compare');
    
    if (compareMode) {
        btnCompare.className = 'btn btn-primary';
        showInfo('Modo Compara√ß√£o', 'Modo ativado. Selecione consultas para comparar.');
    } else {
        btnCompare.className = 'btn btn-secondary';
        selectedConsultations = [];
        showInfo('Modo Compara√ß√£o', 'Modo desativado.');
    }
}

// Timeline Functions
function toggleConsultationDetails(consultationId) {
    // Toggle functionality here
}

// AI Insights Function
function showAIInsights() {
    alert('üß† IA Insights:\\n\\n‚Ä¢ Progresso excepcional: -7kg em 10 meses\\n‚Ä¢ Ganho muscular: +1.5kg (excelente)\\n‚Ä¢ Tend√™ncia positiva em todos os marcadores\\n‚Ä¢ Recomenda√ß√£o: Manter protocolo atual\\n‚Ä¢ Pr√≥xima meta: Atingir 72kg em 3 meses');
}

// Charts Initialization
function initializeCharts() {
    // Evolution Chart
    const evolutionCtx = document.getElementById('evolutionChart');
    if (evolutionCtx) {
        new Chart(evolutionCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out'],
                datasets: [{
                    label: 'Peso (kg)',
                    data: [85, 83, 82, 81, 80, 79.5, 79, 78.5, 78.2, 78],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Gordura (%)',
                    data: [28, 27, 26.5, 25.8, 25, 24.5, 24, 23.5, 23.2, 22.8],
                    borderColor: '#f59e0b',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    tension: 0.4
                }, {
                    label: 'M√∫sculo (kg)',
                    data: [58, 58.2, 58.5, 58.8, 59, 59.2, 59.3, 59.4, 59.45, 59.5],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary') }
                    }
                },
                scales: {
                    x: { 
                        grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border') },
                        ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted') }
                    },
                    y: { 
                        grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border') },
                        ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted') }
                    }
                }
            }
        });
    }

    // Radar Chart
    const radarCtx = document.getElementById('radarChart');
    if (radarCtx) {
        new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: ['Bra√ßo', 'Coxa', 'Cintura', 'Quadril', 'Abd√¥men'],
                datasets: [{
                    label: 'Inicial',
                    data: [32, 60, 85, 105, 95],
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.2)',
                }, {
                    label: 'Atual',
                    data: [30, 56, 75, 98, 85],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.2)',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary') }
                    }
                },
                scales: {
                    r: {
                        grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border') },
                        pointLabels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary') },
                        ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted') }
                    }
                }
            }
        });
    
    // Macros Chart
    const macrosCtx = document.getElementById('macrosChart');
    if (macrosCtx) {
        new Chart(macrosCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Abr', 'Jun', 'Nov'],
                datasets: [{
                    label: 'Calorias',
                    data: [1800, 2000, 1700, 1750],
                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                    borderColor: '#3b82f6'
                }, {
                    label: 'Carboidratos',
                    data: [100, 200, 50, 80],
                    backgroundColor: 'rgba(16, 185, 129, 0.6)',
                    borderColor: '#10b981'
                }, {
                    label: 'Prote√≠nas',
                    data: [150, 160, 170, 165],
                    backgroundColor: 'rgba(245, 158, 11, 0.6)',
                    borderColor: '#f59e0b'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary') }
                    }
                },
                scales: {
                    x: { 
                        grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border') },
                        ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted') }
                    },
                    y: { 
                        grid: { color: getComputedStyle(document.documentElement).getPropertyValue('--border') },
                        ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted') }
                    }
                }
            }
        });
    }    }
}</script>
{% endblock %}




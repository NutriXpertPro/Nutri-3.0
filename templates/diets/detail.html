{% extends 'base.html' %}
{% load static %}

{% block title %}{{ diet.name }} - Detalhes da Dieta{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/diet-components.css' %}">
{% endblock %}

{% block content %}
<div class="page-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">{{ diet.name }}</h1>
      <p class="page-description">Dieta de {{ diet.patient.user.name }}</p>
    </div>
    <div class="header-actions">
      <a href="{% url 'diets:create' %}?duplicate={{ diet.id }}" class="btn btn-secondary">
        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
        Duplicar
      </a>
      <a href="{% url 'diets:list' %}" class="btn btn-ghost">
        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Voltar
      </a>
    </div>
  </div>

  <!-- Diet Info Card -->
  <div class="content-card">
    <div class="card-header">
      <h3 class="card-title">Informações Gerais</h3>
      <div class="card-actions">
        <button onclick="printDiet()" class="btn btn-ghost btn-sm">
          <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
          </svg>
          Imprimir
        </button>
      </div>
    </div>
    
    <div class="card-content">
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Paciente</span>
          <span class="info-value">{{ diet.patient.user.name }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Criada em</span>
          <span class="info-value">{{ diet.created_at|date:"d/m/Y às H:i" }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Total de Refeições</span>
          <span class="info-value">{{ diet.meals|length }} refeição{{ diet.meals|length|pluralize:"es" }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Substituições</span>
          <span class="info-value">
            {% if diet.substitutions %}
              {{ diet.substitutions|length }} configurada{{ diet.substitutions|length|pluralize:"s" }}
            {% else %}
              Nenhuma
            {% endif %}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Meals Section -->
  <div class="content-card">
    <div class="card-header">
      <h3 class="card-title">
        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Refeições
      </h3>
    </div>
    
    <div class="card-content">
      <div class="meals-timeline">
        {% for meal in diet.meals %}
          <div class="timeline-item">
            <div class="timeline-marker">
              <span class="timeline-time">{{ meal.time|default:"--:--" }}</span>
            </div>
            <div class="timeline-content">
              <div class="meal-header">
                <h4 class="meal-name">{{ meal.name }}</h4>
                {% if meal.foods %}
                  <span class="meal-count">{{ meal.foods|length }} item{{ meal.foods|length|pluralize:"ns" }}</span>
                {% endif %}
              </div>
              
              {% if meal.foods %}
                <div class="foods-list">
                  {% for food in meal.foods %}
                    <div class="food-item">
                      <div class="food-info">
                        <span class="food-name">{{ food.name }}</span>
                        <span class="food-quantity">{{ food.quantity }}</span>
                      </div>
                      {% if food.calories %}
                        <span class="food-calories">{{ food.calories }} cal</span>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Substitutions Section -->
  {% if diet.substitutions %}
    <div class="content-card">
      <div class="card-header">
        <h3 class="card-title">
          <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
          </svg>
          Substituições Disponíveis
        </h3>
      </div>
      
      <div class="card-content">
        <div class="substitutions-grid">
          {% for substitution in diet.substitutions %}
            <div class="substitution-card">
              <div class="substitution-header">
                <h5 class="original-food">{{ substitution.original }}</h5>
                <span class="substitution-arrow">
                  <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                  </svg>
                </span>
              </div>
              
              <div class="substitution-options">
                {% for option in substitution.options %}
                  <div class="substitution-option">
                    <span class="option-name">{{ option.name }}</span>
                    <span class="option-quantity">{{ option.quantity }}</span>
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
</div>

<script>
function printDiet() {
  window.print();
}
</script>

{% endblock %}

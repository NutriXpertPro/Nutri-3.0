{% extends 'base.html' %}

{% block title %}Novo Dashboard - NutriVida Pro{% endblock %}

{% block content %}
{% load static %}
<div class="min-h-screen bg-green-50">
    <!-- Top Navigation Bar -->
    <nav class="bg-white shadow-sm px-8 py-4 flex items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center">
            <span class="text-xl font-bold text-gray-800">NUTRI XPERT PRO</span>
        </div>

        <!-- Search Bar -->
        <div class="relative flex-grow mx-8">
            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <input type="text" placeholder="Buscar pacientes, dietas, consultas..." class="w-full pl-10 pr-4 py-2 rounded-lg bg-gray-100 border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <!-- Right Icons/User Menu -->
        <div class="flex items-center space-x-4">
            <!-- Notifications -->
            <div class="relative">
                <i class="fas fa-bell text-gray-600 text-lg cursor-pointer hover:text-blue-500"></i>
                <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>
            </div>
            <!-- Help -->
            <i class="fas fa-question-circle text-gray-600 text-lg cursor-pointer hover:text-blue-500"></i>
            <!-- User Profile -->
            <div class="relative">
                <img src="https://picsum.photos/seed/nutricionista/40/40.jpg" alt="User Avatar" class="h-10 w-10 rounded-full cursor-pointer">
                <!-- Dropdown will go here -->
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <div class="p-8">
        <!-- Dynamic Hero Section -->
        <div class="flex justify-between items-center mb-8">
            <!-- Dynamic Greeting -->
            <div>
                <h1 id="dynamic-greeting" class="text-3xl font-bold text-gray-800"></h1>
                <p class="text-gray-600 mt-1">Aqui está o seu foco para hoje.</p>
            </div>
            <!-- Key Metric -->
            <div class="text-right">
                <p class="text-gray-600">Consultas Hoje</p>
                <p class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-green-500">{{ consultas_hoje }}</p>
            </div>
        </div>

        <script>
            (function() {
                const greetingElement = document.getElementById('dynamic-greeting');
                if (!greetingElement) return;

                const currentHour = new Date().getHours();
                let greeting = 'Olá';

                if (currentHour < 12) {
                    greeting = 'Bom dia';
                } else if (currentHour < 18) {
                    greeting = 'Boa tarde';
                } else {
                    greeting = 'Boa noite';
                }

                greetingElement.textContent = `${greeting}, Dr. {{ request.user.first_name }}`;
            })();
        </script>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Card 1: Pacientes Ativos -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 hover:shadow-lg transition duration-300">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-users text-blue-500 text-2xl"></i>
                    <span class="text-sm text-gray-500">Ver todos</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-800">120</h2> <!-- Placeholder -->
                <p class="text-gray-600">Pacientes Ativos</p>
            </div>
            <!-- Card 2: Consultas Hoje -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 hover:shadow-lg transition duration-300">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-calendar-alt text-green-500 text-2xl"></i>
                    <span class="text-sm text-gray-500">Hoje</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-800">5</h2> <!-- Placeholder -->
                <p class="text-gray-600">Consultas Agendadas</p>
            </div>
            <!-- Card 3: Planos a Vencer -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 hover:shadow-lg transition duration-300">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-file-alt text-orange-500 text-2xl"></i>
                    <span class="text-sm text-gray-500">Próx. 7 dias</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-800">8</h2> <!-- Placeholder -->
                <p class="text-gray-600">Planos a Vencer</p>
            </div>
            <!-- Card 4: Feedback Pendente -->
            <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200 hover:shadow-lg transition duration-300">
                <div class="flex items-center justify-between mb-4">
                    <i class="fas fa-comment-dots text-purple-500 text-2xl"></i>
                    <span class="text-sm text-gray-500">Novas</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-800">3</h2> <!-- Placeholder -->
                <p class="text-gray-600">Feedback Pendente</p>
            </div>
        </div>

        <!-- Main Content Grid (Agenda and Recent Patients) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Vertical Timeline for Agenda -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6 border border-gray-200">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">Agenda do Dia</h2>
                    <a href="#" class="text-blue-600 hover:underline text-sm">Ver agenda completa</a>
                </div>
                <div class="flow-root">
                    <ul role="list" class="-mb-8">
                        {% for appointment in appointments_today %}
                        <li>
                            <div class="relative pb-8">
                                {% if not forloop.last %}
                                <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                                {% endif %}
                                <div class="relative flex space-x-3">
                                    <div>
                                        <span class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                                            <i class="fas fa-calendar-check text-white"></i>
                                        </span>
                                    </div>
                                    <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                        <div>
                                            <p class="text-sm text-gray-500">{{ appointment.date|time:"H:i" }} - <span class="font-medium text-gray-900">{{ appointment.patient.patient_user.name }}</span></p>
                                        </div>
                                        <div class="text-right text-sm whitespace-nowrap text-gray-500">
                                            <time datetime="{{ appointment.date|date:"Y-m-d" }}">{{ appointment.notes|default:"Consulta"|truncatechars:20 }}</time>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% empty %}
                        <li>
                            <div class="relative pb-8">
                                <div class="relative flex space-x-3">
                                    <div>
                                        <span class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center ring-8 ring-white">
                                            <i class="fas fa-calendar-times text-gray-500"></i>
                                        </span>
                                    </div>
                                    <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                        <div>
                                            <p class="text-sm text-gray-500">Nenhuma consulta para hoje.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- Right Column: Paciente em Foco -->
            <div class="lg:col-span-1 bg-white rounded-lg shadow-md p-6 border border-gray-200 text-center">
                <h2 class="text-xl font-bold text-gray-800 mb-6">Paciente em Foco</h2>
                {% if patient_in_focus %}
                    {% if patient_in_focus.patient_user.gender == 'F' %}
                        <img src="{% static 'images/placeholder_female.svg' %}" alt="Paciente Feminino" class="h-24 w-24 rounded-full mx-auto mb-4 object-cover">
                    {% else %}
                        <img src="{% static 'images/placeholder_male.svg' %}" alt="Paciente Masculino" class="h-24 w-24 rounded-full mx-auto mb-4 object-cover">
                    {% endif %}
                    <p class="text-2xl font-bold text-gray-800">{{ patient_in_focus.patient_user.name }}</p>
                    <p class="text-sm text-gray-600 mb-4">{{ patient_in_focus.goal|default:"Sem objetivo definido" }}</p>
                    <div class="mb-6">
                        <p class="text-lg font-semibold text-blue-600">Progresso: {{ patient_in_focus.progress_metric|default:"N/A" }}</p>
                    </div>
                    <div class="flex justify-center space-x-3">
                        <a href="#" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition duration-300">Ver Perfil</a>
                        <a href="#" class="bg-green-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-600 transition duration-300">Mensagem</a>
                    </div>
                {% else %}
                    <div class="py-10">
                        <i class="fas fa-user-circle text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Nenhum paciente em foco.</p>
                        <p class="text-sm text-gray-400 mt-2">Adicione um paciente para vê-lo aqui.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
